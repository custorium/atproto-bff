{{ define "content" }}
 <button class="secondary" onclick="fedcmlogin(event)">Login with FedCM</button>
 <form id="fedcm" method="post">
    <input id="idtoken" name="idtoken" type="hidden">
  </form>
  <script>
    async function fedcmlogin(event) {
      event.preventDefault()
      event.stopPropagation()
      const identityCredential = await navigator.credentials.get({
        identity: {
          context: "signin",
          providers: [
            {
              configURL: "any",
              type: "atproto",
              clientId: "https://explorer.farmapps.eu/oauth-client-metadata.json",
              params: {
                "code_challenge": {{.CodeChallenge}},
                "code_challenge_method": "S256",
              },
          },
        ]
      }
    }).catch(e => {
      console.log("Error", e.message);
    });
    document.getElementById("idtoken").value = identityCredential.token
    document.getElementById("fedcm").submit()
  }
</script>
{{ end }}
